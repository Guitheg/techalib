import technicalysis as ta
from numpy import array, nan, testing
import pandas as pd

def test_sma_numpy_success():
    close = array([0.02214153, 0.12513059, 0.43471736, 0.30710576, 0.30897127,
       0.2185392 , 0.63970966, 0.84203737, 0.27740458, 0.46615793,
       0.5480106 , 0.32422   , 0.02775321, 0.5352502 , 0.08539612,
       0.84522435, 0.34491575, 0.95791077, 0.48665256, 0.95813092,
       0.9693969 , 0.03522551, 0.78939144, 0.32427031, 0.77483514,
       0.45238907, 0.70438955, 0.51321471, 0.3962699 , 0.47909857,
       0.56488284, 0.85505669, 0.69955982, 0.64226104, 0.43229368,
       0.41764135, 0.76912078, 0.82248675, 0.4956754 , 0.92019296,
       0.54586236, 0.52548867, 0.72692747, 0.34155966, 0.76115672,
       0.46020661, 0.20844067, 0.5747126 , 0.99542623, 0.41912518,
       0.37978509, 0.56230143, 0.86366265, 0.96306478, 0.95517964,
       0.43703539, 0.28544032, 0.28677272, 0.29731416, 0.01475919,
       0.99233758, 0.05695488, 0.24631444, 0.98475471, 0.34036762,
       0.65502438, 0.31558758, 0.74047364, 0.24700732, 0.87032647,
       0.64337357, 0.77197742, 0.39263964, 0.22140954, 0.63675664,
       0.22550333, 0.19264853, 0.10545531, 0.51598537, 0.14122207,
       0.6842307 , 0.7277168 , 0.33381768, 0.3715628 , 0.67324592,
       0.29813869, 0.13532713, 0.39760021, 0.17360078, 0.86573465,
       0.96526086, 0.88501837, 0.6291948 , 0.32039882, 0.689105  ,
       0.49115524, 0.17150721, 0.11785142, 0.39755557, 0.01782469])

    expected = array([       nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan, 0.47312869,
       0.49122007, 0.51555094, 0.52437902, 0.53555087, 0.53966161,
       0.54629835, 0.55061206, 0.54996037, 0.55723606, 0.57237056,
       0.57229895, 0.57900791, 0.60231372, 0.59585737, 0.61838272,
       0.6055488 , 0.60099963, 0.58822635, 0.60518548, 0.58721862,
       0.56756489, 0.58513409, 0.5876098 , 0.60890295, 0.61491443,
       0.61440264, 0.60043766, 0.5928896 , 0.58959107, 0.57411309,
       0.58836159, 0.56175819, 0.54665001, 0.55806647, 0.55500227,
       0.56291503, 0.54779726, 0.54506349, 0.53677455, 0.53511234,
       0.53836271, 0.546579  , 0.53543608, 0.53143107, 0.5272844 ,
       0.51946096, 0.51893456, 0.50329265, 0.48731128, 0.47804785,
       0.48819603, 0.49370988, 0.47604838, 0.45633165, 0.44693386,
       0.44230397, 0.43730019, 0.44099444, 0.43687067, 0.46523651,
       0.46433396, 0.49193607, 0.50469875, 0.48255356, 0.49417814,
       0.48871583, 0.48391315, 0.46315908, 0.46817735, 0.43976063])

    out = ta.sma(close, 30)
    testing.assert_allclose(out, expected)

def test_sma_pandas_success():
    close_df = pd.Series(array([0.02214153, 0.12513059, 0.43471736, 0.30710576, 0.30897127,
       0.2185392 , 0.63970966, 0.84203737, 0.27740458, 0.46615793,
       0.5480106 , 0.32422   , 0.02775321, 0.5352502 , 0.08539612,
       0.84522435, 0.34491575, 0.95791077, 0.48665256, 0.95813092,
       0.9693969 , 0.03522551, 0.78939144, 0.32427031, 0.77483514,
       0.45238907, 0.70438955, 0.51321471, 0.3962699 , 0.47909857,
       0.56488284, 0.85505669, 0.69955982, 0.64226104, 0.43229368,
       0.41764135, 0.76912078, 0.82248675, 0.4956754 , 0.92019296,
       0.54586236, 0.52548867, 0.72692747, 0.34155966, 0.76115672,
       0.46020661, 0.20844067, 0.5747126 , 0.99542623, 0.41912518,
       0.37978509, 0.56230143, 0.86366265, 0.96306478, 0.95517964,
       0.43703539, 0.28544032, 0.28677272, 0.29731416, 0.01475919,
       0.99233758, 0.05695488, 0.24631444, 0.98475471, 0.34036762,
       0.65502438, 0.31558758, 0.74047364, 0.24700732, 0.87032647,
       0.64337357, 0.77197742, 0.39263964, 0.22140954, 0.63675664,
       0.22550333, 0.19264853, 0.10545531, 0.51598537, 0.14122207,
       0.6842307 , 0.7277168 , 0.33381768, 0.3715628 , 0.67324592,
       0.29813869, 0.13532713, 0.39760021, 0.17360078, 0.86573465,
       0.96526086, 0.88501837, 0.6291948 , 0.32039882, 0.689105  ,
       0.49115524, 0.17150721, 0.11785142, 0.39755557, 0.01782469]))

    expected = pd.Series(array([       nan,        nan,        nan,        nan,        nan,
                nan,        nan,        nan,        nan,        nan,
                nan,        nan,        nan,        nan,        nan,
                nan,        nan,        nan,        nan,        nan,
                nan,        nan,        nan,        nan,        nan,
                nan,        nan,        nan,        nan, 0.47312869,
        0.49122007, 0.51555094, 0.52437902, 0.53555087, 0.53966161,
        0.54629835, 0.55061206, 0.54996037, 0.55723606, 0.57237056,
        0.57229895, 0.57900791, 0.60231372, 0.59585737, 0.61838272,
        0.6055488 , 0.60099963, 0.58822635, 0.60518548, 0.58721862,
        0.56756489, 0.58513409, 0.5876098 , 0.60890295, 0.61491443,
        0.61440264, 0.60043766, 0.5928896 , 0.58959107, 0.57411309,
        0.58836159, 0.56175819, 0.54665001, 0.55806647, 0.55500227,
        0.56291503, 0.54779726, 0.54506349, 0.53677455, 0.53511234,
        0.53836271, 0.546579  , 0.53543608, 0.53143107, 0.5272844 ,
        0.51946096, 0.51893456, 0.50329265, 0.48731128, 0.47804785,
        0.48819603, 0.49370988, 0.47604838, 0.45633165, 0.44693386,
        0.44230397, 0.43730019, 0.44099444, 0.43687067, 0.46523651,
        0.46433396, 0.49193607, 0.50469875, 0.48255356, 0.49417814,
        0.48871583, 0.48391315, 0.46315908, 0.46817735, 0.43976063]))

    out = ta.sma(close_df, 30)
    assert(type(out) == type(close_df))
    testing.assert_allclose(out, expected)