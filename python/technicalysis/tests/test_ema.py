import technicalysis as ta
from numpy import array, nan, testing
import pandas as pd

def test_sma_numpy_success():
    close = array([0.02214153, 0.12513059, 0.43471736, 0.30710576, 0.30897127,
       0.2185392 , 0.63970966, 0.84203737, 0.27740458, 0.46615793,
       0.5480106 , 0.32422   , 0.02775321, 0.5352502 , 0.08539612,
       0.84522435, 0.34491575, 0.95791077, 0.48665256, 0.95813092,
       0.9693969 , 0.03522551, 0.78939144, 0.32427031, 0.77483514,
       0.45238907, 0.70438955, 0.51321471, 0.3962699 , 0.47909857,
       0.56488284, 0.85505669, 0.69955982, 0.64226104, 0.43229368,
       0.41764135, 0.76912078, 0.82248675, 0.4956754 , 0.92019296,
       0.54586236, 0.52548867, 0.72692747, 0.34155966, 0.76115672,
       0.46020661, 0.20844067, 0.5747126 , 0.99542623, 0.41912518,
       0.37978509, 0.56230143, 0.86366265, 0.96306478, 0.95517964,
       0.43703539, 0.28544032, 0.28677272, 0.29731416, 0.01475919,
       0.99233758, 0.05695488, 0.24631444, 0.98475471, 0.34036762,
       0.65502438, 0.31558758, 0.74047364, 0.24700732, 0.87032647,
       0.64337357, 0.77197742, 0.39263964, 0.22140954, 0.63675664,
       0.22550333, 0.19264853, 0.10545531, 0.51598537, 0.14122207,
       0.6842307 , 0.7277168 , 0.33381768, 0.3715628 , 0.67324592,
       0.29813869, 0.13532713, 0.39760021, 0.17360078, 0.86573465,
       0.96526086, 0.88501837, 0.6291948 , 0.32039882, 0.689105  ,
       0.49115524, 0.17150721, 0.11785142, 0.39755557, 0.01782469])

    expected = array([       nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan, 0.47312869,
       0.47904832, 0.50330692, 0.5159684 , 0.52411631, 0.51819227,
       0.51170511, 0.52831258, 0.54729156, 0.54396148, 0.56823448,
       0.56679112, 0.56412644, 0.57462974, 0.55959296, 0.57259707,
       0.56534607, 0.54231992, 0.54440977, 0.5735076 , 0.56354745,
       0.55169181, 0.5523763 , 0.57245929, 0.59765965, 0.62072545,
       0.60887448, 0.58800776, 0.56857324, 0.55107266, 0.51647179,
       0.54717281, 0.51554584, 0.49817608, 0.52956825, 0.51736175,
       0.52624321, 0.51265253, 0.52735066, 0.509264  , 0.53255835,
       0.53970772, 0.55469286, 0.54423781, 0.52341018, 0.53072286,
       0.51103128, 0.49049045, 0.46564948, 0.46889695, 0.44775664,
       0.46301303, 0.48009069, 0.47065372, 0.46426076, 0.47774367,
       0.46615626, 0.44481244, 0.44176649, 0.42446548, 0.45293446,
       0.48598777, 0.51173168, 0.51930995, 0.50647697, 0.51825943,
       0.51651077, 0.49425247, 0.46996854, 0.46529673, 0.43642757])

    out = ta.ema(close, 30, 2)
    testing.assert_allclose(out, expected)

def test_sma_pandas_success():
    close_df = pd.Series(array([0.02214153, 0.12513059, 0.43471736, 0.30710576, 0.30897127,
       0.2185392 , 0.63970966, 0.84203737, 0.27740458, 0.46615793,
       0.5480106 , 0.32422   , 0.02775321, 0.5352502 , 0.08539612,
       0.84522435, 0.34491575, 0.95791077, 0.48665256, 0.95813092,
       0.9693969 , 0.03522551, 0.78939144, 0.32427031, 0.77483514,
       0.45238907, 0.70438955, 0.51321471, 0.3962699 , 0.47909857,
       0.56488284, 0.85505669, 0.69955982, 0.64226104, 0.43229368,
       0.41764135, 0.76912078, 0.82248675, 0.4956754 , 0.92019296,
       0.54586236, 0.52548867, 0.72692747, 0.34155966, 0.76115672,
       0.46020661, 0.20844067, 0.5747126 , 0.99542623, 0.41912518,
       0.37978509, 0.56230143, 0.86366265, 0.96306478, 0.95517964,
       0.43703539, 0.28544032, 0.28677272, 0.29731416, 0.01475919,
       0.99233758, 0.05695488, 0.24631444, 0.98475471, 0.34036762,
       0.65502438, 0.31558758, 0.74047364, 0.24700732, 0.87032647,
       0.64337357, 0.77197742, 0.39263964, 0.22140954, 0.63675664,
       0.22550333, 0.19264853, 0.10545531, 0.51598537, 0.14122207,
       0.6842307 , 0.7277168 , 0.33381768, 0.3715628 , 0.67324592,
       0.29813869, 0.13532713, 0.39760021, 0.17360078, 0.86573465,
       0.96526086, 0.88501837, 0.6291948 , 0.32039882, 0.689105  ,
       0.49115524, 0.17150721, 0.11785142, 0.39755557, 0.01782469]))

    expected = pd.Series(array([       nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan,        nan,
              nan,        nan,        nan,        nan, 0.47312869,
       0.47904832, 0.50330692, 0.5159684 , 0.52411631, 0.51819227,
       0.51170511, 0.52831258, 0.54729156, 0.54396148, 0.56823448,
       0.56679112, 0.56412644, 0.57462974, 0.55959296, 0.57259707,
       0.56534607, 0.54231992, 0.54440977, 0.5735076 , 0.56354745,
       0.55169181, 0.5523763 , 0.57245929, 0.59765965, 0.62072545,
       0.60887448, 0.58800776, 0.56857324, 0.55107266, 0.51647179,
       0.54717281, 0.51554584, 0.49817608, 0.52956825, 0.51736175,
       0.52624321, 0.51265253, 0.52735066, 0.509264  , 0.53255835,
       0.53970772, 0.55469286, 0.54423781, 0.52341018, 0.53072286,
       0.51103128, 0.49049045, 0.46564948, 0.46889695, 0.44775664,
       0.46301303, 0.48009069, 0.47065372, 0.46426076, 0.47774367,
       0.46615626, 0.44481244, 0.44176649, 0.42446548, 0.45293446,
       0.48598777, 0.51173168, 0.51930995, 0.50647697, 0.51825943,
       0.51651077, 0.49425247, 0.46996854, 0.46529673, 0.43642757]))

    out = ta.ema(close_df, 30, 2)
    assert(type(out) == type(close_df))
    testing.assert_allclose(out, expected)